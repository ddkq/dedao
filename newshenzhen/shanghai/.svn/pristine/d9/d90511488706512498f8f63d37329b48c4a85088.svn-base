var g_Interval = 1;
var total = 0;//参加抽奖人数
var g_Timer;
var running = false;
var time1 = 0;
var time2 = 0;
var time3 = 0;
var time4 = 0;
var reset = 0;
var count = 5;
var frequency = 0;
var nextTime = false;
var arr = new Array();
var url = 'http://www.cdddkqyy.com/';

function beginRndNum(trigger){
	if(nextTime) {
		if(running){
			running = false;
			clearTimeout(g_Timer);
			
			if(frequency == 9) {
				count = 4;
			}
			
			if(frequency > 5 && frequency < 9) {
				$.post(url+'award/award/lottery', {default: 1, count: 6}, function(data) {
					// console.log(data)
					for(var i = 0; i < data.length; i ++) {
						$('.num-box .num').eq(i).children('i').html(data[i]);
					}
					if(time3 == 1) {
						$('.result div').eq(-1).after('<div class="text-white mr-3 ml-3 result-text position-relative">【德国ICX种植体中奖结果一】'+data+'</div>');
					}
					else if(time3 == 2) {
						$('.result div').eq(-1).after('<div class="text-white mr-3 ml-3 result-text position-relative">【德国ICX种植体中奖结果二】'+data+'</div>');
					}
					else if(time3 == 3) {
						$('.result div').eq(-1).after('<div class="text-white mr-3 ml-3 result-text position-relative">【德国ICX种植体中奖结果三】'+data+'</div>');
					}
				});
			}
			else {
				if(frequency == 1) {
					$.post(url+'award/award/lottery', {reset: 1,count: count}, function(data) {
						// console.log(data)
						for(var i = 0; i < data.length; i ++) {
							$('.num-box .num').eq(i).children('i').html(data[i]);
						}
						if(frequency > 0 && frequency < 4) {
							if(time1 == 1) {
								$('.result div').eq(-1).after('<div class="text-white mr-3 ml-3 result-text position-relative">【1000元种牙抵扣券中奖结果一】'+data+'</div>');
							}
						}
					});
				}
				else {
					$.post(url+'award/award/lottery', {count: count}, function(data) {
						// console.log(data)
						for(var i = 0; i < data.length; i ++) {
							$('.num-box .num').eq(i).children('i').html(data[i]);
						}
						if(frequency > 0 && frequency < 4) {
							if(time1 == 2) {
								$('.result div').eq(-1).after('<div class="text-white mr-3 ml-3 result-text position-relative">【1000元种牙抵扣券中奖结果二】'+data+'</div>');
							}
							else if(time1 == 3) {
								$('.result div').eq(-1).after('<div class="text-white mr-3 ml-3 result-text position-relative">【1000元种牙抵扣券中奖结果三】'+data+'</div>');
							}
						}
						if(frequency > 3 && frequency < 6) {
							if(time2 == 1) {
								$('.result div').eq(-1).after('<div class="text-white mr-3 ml-3 result-text position-relative">【2000元种牙抵扣券中奖结果一】'+data+'</div>');
							}
							else if(time2 == 2) {
								$('.result div').eq(-1).after('<div class="text-white mr-3 ml-3 result-text position-relative">【2000元种牙抵扣券中奖结果二】'+data+'</div>');
							}
						}
						if(frequency > 8 && frequency < 11) {
							if(time4 == 1) {
								$('.result div').eq(-1).after('<div class="text-white mr-3 ml-3 result-text position-relative">【小米手环②中奖结果一】'+data+'</div>');
							}
							else if(time4 == 2) {
								$('.result div').eq(-1).after('<div class="text-white mr-3 ml-3 result-text position-relative">【小米手环②中奖结果二】'+data+'</div>');
							}
						}
					});
				}
			}

			nextTime = false;
		}
		else{
			return;
		}
	}
	else {
		alert('请点击开始下一轮');
	}
}

function updateRndNum(){
	var num = Math.floor(Math.random()*total+1);
	$('.num-box').find('.num').children('i').html(num);
}

function beginTimer(){
	g_Timer = setTimeout(beat, g_Interval);
}

function beat() {
	g_Timer = setTimeout(beat, g_Interval);
	updateRndNum();
}
$('.next-time').click(function() {
	if(nextTime) {
		alert('抽奖已结束');
		return;
	}
	else {
		nextTime = true;

		time1 != 3 ? time1 ++ : time2 != 2 ? time2 ++ : time3 != 3 ? time3 ++: time4 !=3 ? time4 ++ : '';
		if(time4 == 3) {
			alert('抽奖已结束');
			return;
		}
		frequency ++;
		
		running = true;
		beginTimer();

		if(frequency == 4) {
			$('.title').html('2000元种牙抵扣券');
		}
		else if(frequency == 6) {
			$('.title').html('德国ICX种植体');
		}
		else if(frequency == 9) {
			$('.title').html('小米手环②');
		}

		if(frequency == 6) {
			$('.num-box .num').eq(-1).after('<div class="num d-flex justify-content-center"><i id="ResultNum">00</i></div>');
		}
		else if(frequency == 9) {
			$('.num-box .num').eq(-1).remove();
			$('.num-box .num').eq(-1).remove();
		}
		$('.num-box').find('.num').children('i').html('00');
	}
})
$(document).keydown(function(e){
    if(!e) var e = window.event; 
    if(e.keyCode == 32){
        if(nextTime) {
			if(running){
				running = false;
				clearTimeout(g_Timer);
				
				if(frequency == 9) {
					count = 4;
				}
				
				if(frequency > 5 && frequency < 9) {
					$.post(url+'award/award/lottery', {default: 1, count: 6}, function(data) {
						// console.log(data)
						for(var i = 0; i < data.length; i ++) {
							$('.num-box .num').eq(i).children('i').html(data[i]);
						}
						if(time3 == 1) {
							$('.result div').eq(-1).after('<div class="text-white mr-3 ml-3 result-text position-relative">【德国ICX种植体中奖结果一】'+data+'</div>');
						}
						else if(time3 == 2) {
							$('.result div').eq(-1).after('<div class="text-white mr-3 ml-3 result-text position-relative">【德国ICX种植体中奖结果二】'+data+'</div>');
						}
						else if(time3 == 3) {
							$('.result div').eq(-1).after('<div class="text-white mr-3 ml-3 result-text position-relative">【德国ICX种植体中奖结果三】'+data+'</div>');
						}
					});
				}
				else {
					if(frequency == 1) {
						$.post(url+'award/award/lottery', {reset: 1,count: count}, function(data) {
							// console.log(data)
							for(var i = 0; i < data.length; i ++) {
								$('.num-box .num').eq(i).children('i').html(data[i]);
							}
							if(frequency > 0 && frequency < 4) {
								if(time1 == 1) {
									$('.result div').eq(-1).after('<div class="text-white mr-3 ml-3 result-text position-relative">【1000元种牙抵扣券中奖结果一】'+data+'</div>');
								}
							}
						});
					}
					else {
						$.post(url+'award/award/lottery', {count: count}, function(data) {
							// console.log(data)
							for(var i = 0; i < data.length; i ++) {
								$('.num-box .num').eq(i).children('i').html(data[i]);
							}
							if(frequency > 0 && frequency < 4) {
								if(time1 == 2) {
									$('.result div').eq(-1).after('<div class="text-white mr-3 ml-3 result-text position-relative">【1000元种牙抵扣券中奖结果二】'+data+'</div>');
								}
								else if(time1 == 3) {
									$('.result div').eq(-1).after('<div class="text-white mr-3 ml-3 result-text position-relative">【1000元种牙抵扣券中奖结果三】'+data+'</div>');
								}
							}
							if(frequency > 3 && frequency < 6) {
								if(time2 == 1) {
									$('.result div').eq(-1).after('<div class="text-white mr-3 ml-3 result-text position-relative">【2000元种牙抵扣券中奖结果一】'+data+'</div>');
								}
								else if(time2 == 2) {
									$('.result div').eq(-1).after('<div class="text-white mr-3 ml-3 result-text position-relative">【2000元种牙抵扣券中奖结果二】'+data+'</div>');
								}
							}
							if(frequency > 8 && frequency < 11) {
								if(time4 == 1) {
									$('.result div').eq(-1).after('<div class="text-white mr-3 ml-3 result-text position-relative">【小米手环②中奖结果一】'+data+'</div>');
								}
								else if(time4 == 2) {
									$('.result div').eq(-1).after('<div class="text-white mr-3 ml-3 result-text position-relative">【小米手环②中奖结果二】'+data+'</div>');
								}
							}
						});
					}
				}

				nextTime = false;
			}
			else{
				return;
			}
		}
		else {
			alert('请点击开始下一轮');
		}
    }
});
$(function() {
	$.post(url+'award/award/total', {}, function(data) {
		// console.log(data)
		total = data;
	});
})