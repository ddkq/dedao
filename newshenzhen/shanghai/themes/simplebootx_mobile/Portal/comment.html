<br>
<h3>评论</h3>
<div class="comment-area" id="comments">

	<div class="comments">
		<foreach name="comments" item="vo">
			<div class="comment" data-id="{$vo.id}" data-uid="{$vo.uid}" data-username="{$vo.full_name}" id="comment{$vo.id}">
				<div class="head-img">
					<img class="avatar" src="{:U('user/public/avatar',array('id'=>$vo['uid']))}" class="headicon" />
				</div>
				<div class="comment-body">
					<div class="comment-content">
						<p class="username">
							{$vo.full_name}
							<span class="time">{:date('m月d日  H:i',strtotime($vo['createtime']))}</span>
						</p>
						<p class="content-text">{$vo.content}</p>
					</div>
					<div class="clearfix">
						<a class="comments-like click-like" href="javascript:;">
							<i class="fa fa-thumbs-o-up"></i>
							<span class="like-num">{$vo['comment_like']}</span>
						</a>
						<a class="comment_reply;" href="javascript:;">回复</a>
					</div>
	
					<if condition="!empty($vo['children'])">
						<foreach name="vo.children" item="voo">
							<div class="comment" data-id="{$voo.id}" data-uid="{$voo.uid}" data-username="{$voo.full_name}" id="comment{$voo.id}">
								<div class="head-img">
									<img class="avatar" src="{:U('user/public/avatar',array('id'=>$voo['uid']))}" class="headicon" />
								</div>
								<div class="comment-body">
									<div class="comment-content">
										<p class="username">
											{$voo.full_name}
											<span class="time">{:date('m月d日  H:i',strtotime($voo['createtime']))}</span>
										</p>
										<p class="content-text">{$voo.content}</p>
									</div>
									<div class="clearfix">
										<a class="comments-like click-like" href="javascript:;">
											<i class="fa fa-thumbs-o-up"></i>
											<span class="like-num">{$voo['comment_like']}</span>
										</a>
										<a class="comment_reply;" href="javascript:;">回复</a>
									</div>
								</div>
								<div class="clearfix"></div>
							</div>
						</foreach>
					</if>
	
				</div>
				<div class="clearfix"></div>
			</div>
		</foreach>
		<ul class="pages">
			<li>
				<a href="/article/7939/p/1.html">1</a>
			</li>
			<li>
				<a href="/article/7939/p/1.html">2</a>
			</li>
		</ul>
	</div>
	
	<form class="form-horizontal comment-form" action="{:U('comment/comment/post')}" method="post">
		<div class="control-group">
			<div class="comment-postbox-wraper">
				<textarea class="form-control comment-postbox" placeholder="请输入评论内容" style="min-height:90px;" name="content"></textarea>
			</div>
		</div>
		<div class="control-group flex">
			<div class="left-input">
				<input type="text" name="full_name" value="" placeholder="姓名" />
				<input type="text" name="verify" value="" placeholder="验证码" /> 
			</div>
			<div class="right-img">
				{:sp_verifycode_img('length=4&font_size=14&width=100&height=34&charset=1234567890&use_noise=1&use_curve=0')}
			</div>
		</div>
		<div class="control-group">
			<button type="button" class="btn btn-primary comment-submit"><i class="fa fa-comment-o"></i><span>发表评论</span></button>
		</div>
	  
		<input type="hidden" name="post_title" value="{$params.post_title}" />
		<input type="hidden" name="post_table" value="{$post_table}" />
		<input type="hidden" name="post_id" value="{$post_id}" />
		<input type="hidden" name="to_uid" value="0" />
		<input type="hidden" name="parentid" value="0" />
		<input type="hidden" name="url" value="" />
	</form>

	
	<script>
		$(function(){
			$("input[name='url']").attr('value',window.location.href);
			
			var page = 1;
			$.post('/comment/comment/index.html',{page:page},function(data){
				console.log(data);
			});
			
			
		});
		$('.comment-submit').click(function(){
			var data = $('.comment-form').serializeArray();
			$.post('/comment/comment/post.html',data,function(result){
				alert(result.info);
				window.location.reload();
			});
		});
		
		$('.comments-like').click(function(){
			var id = $(this).parents('.comment').data('id');
			var like = $(this).find('.like-num');
			var num = parseInt(like.html());
			$.post('/comment/comment/do_like.html',{id,id},function(data){
				if(data.status){
					num+=1;
					like.html(num);
				}
			});
		});
		
		$('.comment_reply').click(function(){
			var id = $(this).data('id');
			var username = $(this).data('username');
			$('.comment_post').find('button span').html('回复评论');
			$('.comment_post').find('input[name="parentid"]').attr('value',id);
			$('.comment_post').find('.comment-postbox').attr('placeholder','回复'+username);
		});
		
		$('.font_content').find('img').parent('p').css('text-indent', 0);
		$('.font_content').find('img').parent('span').css('text-indent', 0);
		$('.font_content').find('img').parent('span').parent('p').css('text-indent', 0);
	</script>
	
</div>

